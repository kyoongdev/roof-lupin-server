// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

generator erd {
  provider = "prisma-erd-generator"
  output   = "../erd.png"
  theme    = "forest"
}

generator docs {
  provider = "node node_modules/prisma-docs-generator"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Image {
  id                String             @id @default(uuid())
  url               String
  spaceUsageImages  SpaceUsageImage[]
  spaceImages       SpaceImage[]
  spaceReviewImages SpaceReviewImage[]
}

model Space {
  id                   String @id @default(uuid())
  title                String @db.VarChar(120)
  description          String
  size                 Int    @db.SmallInt
  rooftopType          Int    @db.TinyInt
  buildingType         Int    @db.TinyInt
  spaceIntroduction    String @db.MediumText
  facilityIntroduction String @db.MediumText
  minUser              Int    @db.TinyInt
  maxUser              Int    @db.TinyInt
  overflowUserCost     Int    @db.MediumInt

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? @db.DateTime

  hostId String @unique @db.VarChar(120)
  host   Host   @relation(fields: [hostId], references: [id])

  reviews         SpaceReview[]
  reports         SpaceReport[]
  userInterests   SpaceInterest[]
  userLikes       SpaceLike[]
  usageImages     SpaceUsageImage[]
  images          SpaceImage[]
  guideLines      SpaceGuideLine[]
  cautions        SpaceCaution[]
  //INFO: discountInfo는 1개만 존재하는지, 여러개 존재하는지 확인 필요
  discountInfo    SpaceDiscountInfo[]
  //INFO: discountInfo는 1개만 존재하는지, 여러개 존재하는지 확인 필요
  rentalType      RentalType[]
  location        SpaceLocation?
  facilities      SpaceFacility[]
  services        SpaceService[]
  usageCategories SpaceUsageCategory[]
  hashTags        SpaceHashTag[]
  spaceQnAs       SpaceQnA[]
}

model SpaceReport {
  id           String @id @default(uuid())
  reportType   Int    @db.TinyInt
  reoirtStatus Int    @db.TinyInt
  title        String @db.VarChar(120)
  content      String @db.MediumText

  spaceId String
  space   Space  @relation(fields: [spaceId], references: [id])
  userId  String
  user    User   @relation(fields: [userId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? @db.DateTime
}

model SpaceQnA {
  id String @id @default(uuid())

  //INFO: title이 필요할 지
  title   String @db.VarChar(120)
  content String @db.MediumText

  spaceId String
  space   Space  @relation(fields: [spaceId], references: [id])
  userId  String
  user    User   @relation(fields: [userId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? @db.DateTime

  answers SpaceQnAAnswer[]
}

//INFO: QnA 답변은 host(공간주인)가 다는건지 Admin(통합관리자)이 다는건지
model SpaceQnAAnswer {
  id      String @id @default(uuid())
  content String @db.MediumText

  spaceQnAId String
  spaceQnA   SpaceQnA @relation(fields: [spaceQnAId], references: [id])
  hostId     String
  host       Host     @relation(fields: [hostId], references: [id])
}

model SpaceReview {
  id      String @id @default(uuid())
  content String @db.MediumText
  spaceId String
  space   Space  @relation(fields: [spaceId], references: [id])
  userId  String
  user    User   @relation(fields: [userId], references: [id])

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? @db.DateTime

  images SpaceReviewImage[]
}

model SpaceReviewImage {
  spaceReviewId String
  spaceReview   SpaceReview @relation(fields: [spaceReviewId], references: [id])
  imageId       String
  image         Image       @relation(fields: [imageId], references: [id])

  @@id([spaceReviewId, imageId])
}

model SpaceInterest {
  spaceId String
  space   Space  @relation(fields: [spaceId], references: [id])
  userId  String
  user    User   @relation(fields: [userId], references: [id])

  @@id([userId, spaceId])
}

model SpaceLike {
  spaceId String
  space   Space  @relation(fields: [spaceId], references: [id])
  userId  String
  user    User   @relation(fields: [userId], references: [id])

  @@id([userId, spaceId])
}

model SpaceUsageImage {
  spaceId String
  space   Space  @relation(fields: [spaceId], references: [id])
  imageId String
  image   Image  @relation(fields: [imageId], references: [id])

  @@id([spaceId, imageId])
}

model SpaceImage {
  spaceId String
  space   Space  @relation(fields: [spaceId], references: [id])
  imageId String
  image   Image  @relation(fields: [imageId], references: [id])

  @@id([spaceId, imageId])
}

model SpaceGuideLine {
  id      String @id @default(uuid())
  content String
  spaceId String
  space   Space  @relation(fields: [spaceId], references: [id])
}

model SpaceCaution {
  id      String @id @default(uuid())
  content String
  spaceId String
  space   Space  @relation(fields: [spaceId], references: [id])
}

model SpaceDiscountInfo {
  id            String @id @default(uuid())
  discountType  Int    @db.TinyInt
  discountValue Int    @db.MediumInt
  name          String @db.VarChar(120)
  content       String
  description   String
  spaceId       String
  space         Space  @relation(fields: [spaceId], references: [id])
}

model RentalType {
  id       String @id @default(uuid())
  name     String @db.VarChar(120)
  cost     Int    @db.MediumInt
  costType Int    @db.TinyInt // 1 : 시간, 2 : 패키지
  baseHour Int?   @db.TinyInt // 기본 이용시간
  startAt  Int    @db.TinyInt // 시작시간
  endAt    Int    @db.TinyInt // 종료시간

  spaceId String
  space   Space  @relation(fields: [spaceId], references: [id])
}

model SpaceLocation {
  spaceId    String   @unique
  space      Space    @relation(fields: [spaceId], references: [id])
  locationId String   @unique
  location   Location @relation(fields: [locationId], references: [id])

  @@id([spaceId, locationId])
}

model SpaceFacility {
  spaceId    String
  space      Space    @relation(fields: [spaceId], references: [id])
  facilityId String
  facility   Facility @relation(fields: [facilityId], references: [id])

  @@id([spaceId, facilityId])
}

model SpaceService {
  spaceId   String
  space     Space   @relation(fields: [spaceId], references: [id])
  serviceId String
  service   Service @relation(fields: [serviceId], references: [id])

  @@id([spaceId, serviceId])
}

model SpaceUsageCategory {
  spaceId         String
  space           Space         @relation(fields: [spaceId], references: [id])
  usageCategoryId String
  usageCategory   UsageCategory @relation(fields: [usageCategoryId], references: [id])

  @@id([spaceId, usageCategoryId])
}

model SpaceHashTag {
  spaceId   String
  space     Space   @relation(fields: [spaceId], references: [id])
  hashTagId String
  hashTag   HashTag @relation(fields: [hashTagId], references: [id])

  @@id([spaceId, hashTagId])
}

model Host {
  id     String @id @default(uuid())
  userId String @db.VarChar(120)
  name   String

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? @db.DateTime

  spaces          Space[]
  spaceQnAAnswers SpaceQnAAnswer[]
}

model Admin {
  id   String @id @default(uuid())
  name String

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? @db.DateTime
}

model User {
  id          String @id @default(uuid())
  name        String @db.VarChar(120)
  nickname    String
  email       String
  phoneNumber String

  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  deletedAt DateTime? @db.DateTime

  spaceReviews   SpaceReview[]
  spaceReports   SpaceReport[]
  spaceInterests SpaceInterest[]
  spaceLikes     SpaceLike[]
  spaceQnAs      SpaceQnA[]
  locations      UserLocation[]
}

//INFO: 유저는 여러 위치를 지정 가능
model UserLocation {
  id         String   @id @default(uuid())
  userId     String
  user       User     @relation(fields: [userId], references: [id])
  locationId String
  location   Location @relation(fields: [locationId], references: [id])
  isDefault  Boolean  @default(false)
}

model Location {
  id            String         @id @default(uuid())
  lat           String         @db.VarChar(120)
  lng           String         @db.VarChar(120)
  roadAddress   String
  jibunAddress  String
  spaceLocation SpaceLocation?
  userLocations UserLocation[]
}

//INFO: 공간 주변 시설
model Facility {
  id              String          @id @default(uuid())
  iconPath        String
  name            String
  spaceFacilities SpaceFacility[]
}

//INFO: 이용 가능한 서비스
model Service {
  id            String         @id @default(uuid())
  iconPath      String
  name          String
  spaceServices SpaceService[]
}

//INFO: 활용 가능한 카테고리 (ex. 회의실, 스터디룸, 세미나실, 오픈스페이스 등)
model UsageCategory {
  id                   String               @id @default(uuid())
  name                 String               @db.VarChar(80)
  spaceUsageCategories SpaceUsageCategory[]
}

//INFO: 해시태그
model HashTag {
  id            String         @id @default(uuid())
  name          String
  spaceHashTags SpaceHashTag[]
}
